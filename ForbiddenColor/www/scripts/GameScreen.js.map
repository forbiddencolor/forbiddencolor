{"version":3,"file":"GameScreen.js","sourceRoot":"","sources":["../../scripts/GameScreen.ts"],"names":["GameScreen","GameScreen.constructor","GameScreen.show","GameScreen.hide","GameScreen.onTimerUpdated","GameScreen.onGameEnded","GameScreen.onGameStarted","GameScreen.onCountDownUpdated","GameScreen.onNextFrame","GameScreen.onTimeBonus","GameScreen.onTouchStart","GameScreen.onTouchStart.removeTouchHandler","GameScreen.onTouchStart.endHandler","GameScreen.onTouchStart.moveHandler","GameScreen.showTouch","GameScreen.resetRipples","GameScreen.renderRipple","GameScreen.waterRipple","GameScreen.animLoop"],"mappings":"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","sourcesContent":["/// <reference path=\"typings/jquery/jquery.d.ts\" />\r\n\r\n\"use strict\";\r\n\r\nimport * as $ from \"jquery\";\r\nimport * as Engine from \"Frame\";\r\nimport {Screen} from \"Screen\";\r\nimport {GameOverScreen} from \"GameOverScreen\";\r\nimport * as timestamp from \"timestamp\";\r\n\r\nexport class GameScreen extends Screen {\r\n    private __onTouchStart: any;\r\n    private engine: Engine.Frame;\r\n    private gameOverScreen: GameOverScreen;\r\n    private currentRipple = [];\r\n    private popupMessageCount = 0;\r\n    private lastScoreTime = +new Date;\r\n\r\n    private $body = $(\"body\");\r\n    private $forbiddencolor = $(\"#forbiddencolor\");\r\n    private $score = $(\"#score > span\");\r\n    private $timebonus = $(\"#timebonus\");\r\n    private $oops = $(\"#oops\");\r\n    private $timer = $(\"#timer > span\");\r\n    private $countdown = $(\"#countdown\");\r\n    private $plusscore = $(\"#plusscore\");\r\n\r\n    public shouldRenderRipples = false;\r\n    public shouldRenderTouches = false;\r\n    public popupmesssagedelay = 750;\r\n\r\n    constructor(engine: Engine.Frame) {\r\n        super(\"gamescreen\");\r\n\r\n        this.engine = engine;\r\n        this.gameOverScreen = new GameOverScreen(engine);\r\n\r\n        this.engine.TimeBonus.on(e => this.onTimeBonus(e));\r\n        this.engine.NextFrame.on(e => this.onNextFrame(e));\r\n        this.engine.GameStarted.on(e => this.onGameStarted(e));\r\n        this.engine.GameEnded.on(e => this.onGameEnded(e));\r\n        this.engine.TimerUpdated.on(e => this.onTimerUpdated(e));\r\n        this.engine.CountDownUpdated.on(e => this.onCountDownUpdated(e));\r\n        \r\n        // ko.applyBindings(this, $(\"#gamescreen\")[0]);\r\n    }\r\n\r\n    public show(): void {\r\n        this.$body.css(\"background-color\", this.engine.CurrentColor.color);\r\n        super.show();\r\n        this.__onTouchStart = this.onTouchStart.bind(this);\r\n        this.$body.on(\"touchstart\", this.__onTouchStart);\r\n        this.engine.start();\r\n\r\n        if (this.shouldRenderRipples) {\r\n            this.resetRipples();\r\n            this.animLoop(this.renderRipple);\r\n        }\r\n    }\r\n\r\n    public hide(): void {\r\n        this.$body.off(\"touchstart\", this.__onTouchStart);\r\n        super.hide();\r\n    }\r\n\r\n    private onTimerUpdated(e: Engine.TimerUpdatedEventArgs): void {\r\n        if (this.engine.TimeLeft < 3) {\r\n            this.$timer.text(this.engine.TimeLeft.toFixed(1));\r\n        } else {\r\n            this.$timer.text(this.engine.TimeLeft.toFixed(0));\r\n        }\r\n    }\r\n\r\n    private onGameEnded(e: Engine.GameEndedEventArgs): void {\r\n        this.$score.text(this.engine.Score.toString());\r\n        this.$timer.text(this.engine.TimeLeft.toString());\r\n        this.hide();\r\n        this.gameOverScreen.score(e.Score);\r\n        this.gameOverScreen.show();\r\n    }\r\n\r\n    private onGameStarted(e: Engine.GameStartedEventArgs): void {\r\n        this.$score.text(this.engine.Score.toString());\r\n        this.$timer.text(this.engine.TimeLeft.toString());\r\n        this.$body.css(\"background-color\", this.engine.CurrentColor.color);\r\n        $(\"#startscreen\").hide();\r\n        $(\"#currentforbiddencolor\").html(this.engine.CurrentColor.name);\r\n        this.$oops.empty();\r\n        this.$plusscore.empty();\r\n        this.$forbiddencolor.find(\"> span\").html(\"Forbidden color<br />\" + this.engine.CurrentColor.name);\r\n        this.$forbiddencolor.removeClass(\"animated fadeOut\");\r\n        this.$forbiddencolor.show();\r\n    }\r\n\r\n    private onCountDownUpdated(e: Engine.CountDownEventArgs): void {\r\n        if (e.CountDown <= 1) {\r\n            this.$forbiddencolor.addClass(\"animated fadeOut\");\r\n            this.resetRipples();\r\n        }\r\n\r\n        var text = e.CountDown === 0 ? \"Go\" : e.CountDown.toString();\r\n\r\n        this.$countdown.find(\"> span\").text(text);\r\n        this.$countdown.css(\"display\", \"block\");\r\n        this.$countdown.addClass(\"animated bounceIn\");\r\n        setTimeout(() => {\r\n            this.$countdown.css(\"display\", \"none\");\r\n        }, this.popupmesssagedelay);\r\n\r\n        this.$body.css(\"background-color\", this.engine.CurrentColor.color);\r\n    }\r\n\r\n    private onNextFrame(e: Engine.NextFrameEventArgs): void {\r\n        if (e.Correct) {\r\n            var now = +new Date;\r\n            var delta = now - this.lastScoreTime;\r\n            if (delta > 180) {\r\n                this.lastScoreTime = now;\r\n                var score = $(\"<div class=\\\"plusscore popupmessage\\\" style=\\\"display: block\\\"><span>+1</span></div>\");\r\n                this.$plusscore.append(score);\r\n                score.addClass(\"animated fadeOutDown\");\r\n                score.one(\"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend\", () => {\r\n                    score.remove();\r\n                });\r\n            }\r\n        } else {\r\n            if (this.popupMessageCount < 3) {\r\n                this.popupMessageCount++;\r\n                var msg = $(\"<div class=\\\"oops popupmessage\\\" style=\\\"display: block\\\"><span>OOPS</span></div>\");\r\n                this.$oops.append(msg);\r\n                msg.addClass(\"animated bounceIn\");\r\n                msg.one(\"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend\", () => {\r\n                    msg.remove();\r\n                    this.popupMessageCount--;\r\n                });\r\n            }\r\n        }\r\n\r\n        this.$score.text(this.engine.Score.toString());\r\n        this.$body.css(\"background-color\", this.engine.CurrentColor.color);\r\n    }\r\n\r\n    private onTimeBonus(e: Engine.TimeBonusEventArgs): void {\r\n        this.$timebonus.find(\".message > span\").text(\"+\" + e.ExtraTime);\r\n\r\n        this.$timebonus.removeClass(\"animated bounceIn\");\r\n        this.$timebonus.css(\"display\", \"block\");\r\n        this.$timebonus.addClass(\"animated bounceIn\");\r\n        setTimeout(() => {\r\n            this.$timebonus.css(\"display\", \"none\");\r\n        }, this.popupmesssagedelay);\r\n    }\r\n\r\n    private onTouchStart(e: any): boolean {\r\n        var that = this,\r\n            frame = this.engine;\r\n        e.preventDefault();\r\n\r\n        // if (!frame.IsStarted) return;\r\n\r\n        if (!e.originalEvent.touches || e.originalEvent.touches.length === 0) {\r\n            return true;\r\n        }\r\n\r\n        var touchStart = e.originalEvent.touches[0],\r\n            startX: number = touchStart.pageX,\r\n            startY: number = touchStart.pageY,\r\n            lastX = startX,\r\n            lastY = startY,\r\n            touchStartTime = new Date().getTime(),\r\n            lastMoveTime = touchStartTime;\r\n\r\n        function removeTouchHandler(): void {\r\n            that.$body.off(\"touchmove\", moveHandler).off(\"touchend\", endHandler);\r\n        };\r\n\r\n        function endHandler(endEvent): boolean {\r\n            var timeDiff = new Date().getTime() - lastMoveTime;\r\n            removeTouchHandler();\r\n\r\n            if (timeDiff < 1000\r\n                && (Math.abs(lastX - startX) > 50 ||\r\n                    Math.abs(lastY - startY) > 50)) {\r\n                if (frame.IsStarted) {\r\n                    frame.swipe();\r\n                }\r\n\r\n                //showTouch(startX, startY);\r\n                //showTouch(lastX - ((lastX - startX) / 2), lastY - ((lastY - startY) / 2));\r\n                //showTouch(lastX, lastY);\r\n            } else {\r\n                if (frame.IsStarted) {\r\n                    frame.tap();\r\n                }\r\n\r\n                that.waterRipple(lastX, lastY);\r\n            }\r\n\r\n            return true;\r\n        };\r\n\r\n        function moveHandler(moveEvent): boolean {\r\n            var touchMove = moveEvent.originalEvent.touches[0],\r\n                movedX = Math.abs(touchMove.pageX - lastX),\r\n                movedY = Math.abs(touchMove.pageY - lastY);\r\n            // timeDiff = new Date().getTime() - lastMoveTime;\r\n\r\n            if (movedX > 30 || movedY > 30) {\r\n                lastX = touchMove.pageX;\r\n                lastY = touchMove.pageY;\r\n\r\n                that.waterRipple(lastX, lastY);\r\n                that.showTouch(lastX, lastY);\r\n            }\r\n\r\n            lastMoveTime = new Date().getTime();\r\n\r\n            return true;\r\n        }\r\n\r\n        that.waterRipple(lastX, lastY);\r\n        that.showTouch(lastX, lastY);\r\n        this.$body.on(\"touchmove\", moveHandler).on(\"touchend\", endHandler);\r\n        return true;\r\n    }\r\n\r\n    private showTouch(pageX, pageY): void {\r\n        if (!this.shouldRenderTouches) {\r\n            return;\r\n        }\r\n\r\n        var target = this.$body;\r\n        var ink = $(\"<div class='ripple'></div>\");\r\n        //if (target.find(\".ink\").length === 0)\r\n        //    target.append(ink);\r\n        //var ink = target.find(\".ripple\");\r\n        //ink.removeClass(\"show\");\r\n\r\n        target.append(ink);\r\n\r\n        var d = Math.max(target.width(), target.height());\r\n        ink.css({ height: d / 2, width: d / 2 });\r\n\r\n        var x = pageX - target.offset().left - ink.width() / 2;\r\n        var y = pageY - target.offset().top - ink.height() / 2;\r\n\r\n        ink.one(\"animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd\", function (): void {\r\n            $(this).remove();\r\n        });\r\n\r\n        setTimeout(() => {\r\n            ink.css({ top: y + \"px\", left: x + \"px\" }).addClass(\"show\");\r\n        }, 0);\r\n    }\r\n\r\n    private resetRipples(): void {\r\n        if (!this.shouldRenderRipples) {\r\n            return;\r\n        }\r\n\r\n        this.$body.ripples(\"destroy\");\r\n\r\n        this.$body.ripples({\r\n            resolution: 512,\r\n            interactive: false\r\n        });\r\n    }\r\n\r\n\r\n    private renderRipple(): void {\r\n        if (this.currentRipple.length > 0) {\r\n            var ripple = this.currentRipple.pop();\r\n            this.currentRipple = [];\r\n            this.$body.ripples(\"drop\", ripple.x, ripple.y, ripple.radius, ripple.strength);\r\n        }\r\n    }\r\n\r\n    private waterRipple(x: number, y: number, radius: number = 10, strength: number = 0.06): void {\r\n        if (!this.shouldRenderRipples) {\r\n            return;\r\n        }\r\n\r\n        this.currentRipple.push({ x, y, radius, strength });\r\n    }\r\n\r\n    private animLoop(render: Function, speed: number = (1000 / 30)): void {\r\n        var running,\r\n            lastFrame = timestamp.now(),\r\n            raf = window.requestAnimationFrame;\r\n\r\n        var loop = (now: number): void => {\r\n            if (running !== false) {\r\n                raf(loop);\r\n                var elapsed = Math.min(1000, now - lastFrame);\r\n\r\n                if (speed <= 0 || elapsed > speed) {\r\n                    lastFrame = now - (elapsed % speed);\r\n                    running = render.bind(this)(elapsed);\r\n                }\r\n            }\r\n        };\r\n\r\n        loop(lastFrame);\r\n    }\r\n}"]}
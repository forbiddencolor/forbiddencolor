{"version":3,"file":"HighScores.js","sourceRoot":"","sources":["../../scripts/HighScores.ts"],"names":["HighScore","HighScore.constructor","HighScoreStorage","HighScoreStorage.constructor","HighScoreStorage.getHighScores","HighScoreStorage.isHighScore","HighScoreStorage.addScore","HighScoreStorage.addHighScore","HighScoreStorage.resetScores","HighScoreStorage.sort"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nexport class HighScore {\r\n    public name: string;\r\n    public score: number;\r\n    public longestStreak: number;\r\n}\r\n\r\nexport class HighScoreStorage {\r\n    public maxEntries: number;\r\n    public maxNameLength: number = 5;\r\n\r\n    constructor(maxEntries: number = 5) {\r\n        this.maxEntries = maxEntries;\r\n    }\r\n\r\n    public getHighScores(): HighScore[] {\r\n        var scores: HighScore[];\r\n\r\n        try {\r\n            var highscoresStr = localStorage.getItem(\"highscores\");\r\n            var highscores = JSON.parse(highscoresStr);\r\n            if (!highscores || !highscores.scores) {\r\n                this.resetScores();\r\n                return this.getHighScores();\r\n            }\r\n            scores = highscores.scores;\r\n        } catch (ex) {\r\n            this.resetScores();\r\n            return this.getHighScores();\r\n        }\r\n\r\n        return scores.sort(this.sort);\r\n    }\r\n\r\n    public isHighScore(score: number): boolean {\r\n        var highScores = this.getHighScores();\r\n        var lowest = highScores[highScores.length - 1];\r\n        return (highScores.length < this.maxEntries) || (score > lowest.score);\r\n    }\r\n\r\n    public addScore(name: string, score: number, longestStreak: number = 0): boolean {\r\n        var hscore = new HighScore();\r\n        hscore.name = name.substr(0, name.length > this.maxNameLength ? this.maxNameLength : name.length);\r\n        hscore.score = score;\r\n        hscore.longestStreak = longestStreak;\r\n        return this.addHighScore(hscore);\r\n    }\r\n\r\n    public addHighScore(score: HighScore): boolean {\r\n        if (!this.isHighScore(score.score)) {\r\n            return false;\r\n        }\r\n\r\n        var scores = this.getHighScores();\r\n        scores.push(score);\r\n\r\n        scores = scores.sort(this.sort)\r\n            .slice(0, this.maxEntries);\r\n\r\n        var highscores = { scores: scores };\r\n        localStorage.setItem(\"highscores\", JSON.stringify(highscores));\r\n        return true;\r\n    }\r\n\r\n    public resetScores(): void {\r\n        var highscores = {\r\n            scores: [\r\n                { name: \"Johan\", score: 43 },\r\n                { name: \"Remco\", score: 38 },\r\n                { name: \"Bob\", score: 27 },\r\n                { name: \"John\", score: 15 },\r\n                { name: \"Chris\", score: 4 }]\r\n        };\r\n        // For testing\r\n        //var highscores = {\r\n        //    scores: [\r\n        //        { name: 'Johan', score: 5 },\r\n        //        { name: 'Remco', score: 4 },\r\n        //        { name: 'Bob', score: 3 },\r\n        //        { name: 'John', score: 2 },\r\n        //        { name: 'Chris', score: 1 }]\r\n        //};\r\n        localStorage.setItem(\"highscores\", JSON.stringify(highscores));\r\n    }\r\n\r\n    private sort(a: any, b: any): number {\r\n        return a.score < b.score ? 1 : 0;\r\n    }\r\n}"]}